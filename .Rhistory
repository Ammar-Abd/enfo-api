# Apply new column names, ensuring the length matches the number of columns
if (length(new_colnames) == ncol(retData)) colnames(retData) <- new_colnames
}
# Update column lists after all renaming and Virtual Register processing to reflect final column names
powerColumns = grep('[kW]', colnames(retData), value = T, fixed = T)
voltageColumns = grep('[V]', colnames(retData), value = T, fixed = T)
currentColumns = grep('[A]', colnames(retData), value = T, fixed = T)
powerfactorColumns = grep('[PF]', colnames(retData), value = T, fixed = T)
frequencyColumns = grep('[F]', colnames(retData), value = T, fixed = T)
}, warning = function(w) {},
# Log any errors with a timestamp for debugging
error = function(e) {cat("Error ", conditionMessage(e), " at", Sys.time(), '\n\n') })
# Return a list containing the processed data and column lists
list("summaryData" = retData, "power" = powerColumns, "volt" = voltageColumns, "current" = currentColumns, "pf" = powerfactorColumns, "frequency" = frequencyColumns)}
spike_check <- function(df, type) {
if (RUN_MODE == 'DEP') df[, -1] <- lapply(df[, -1], as.numeric)
powerColumns = c("Usage", grep('[kW]', colnames(df), value = T, fixed = T))
voltageColumns = grep('[V]', colnames(df), value = T, fixed = T)
currentColumns = grep('[A]', colnames(df), value = T, fixed = T)
powerfactorColumns = grep('[PF]', colnames(df), value = T, fixed = T)
if (type == "minute") {
# Power
for (col in powerColumns) {
if (col %in% colnames(df)){
spikes <- which(df[, col] > 4000)
if (length(spikes) > 0) df[spikes, col] <- NA
}
}
# PowerFactor
# for (col in powerfactorColumns) {
#   spikes <- which(df[, col] > 1)
#   if (length(spikes) > 0) df <- df[-spikes, ]
# }
# Voltage
for (col in voltageColumns) {
spikes <- which(df[, col] > 1000)
if (length(spikes) > 0) df[spikes, col] <- NA
}
} else {
# Power
for (col in powerColumns) {
if (col %in% colnames(df)) {
spikes <- which(df[, col] > 4000)
if (length(spikes) > 0) df[spikes, col] <- NA
}
}
# PowerFactor
# for (col in powerfactorColumns) {
#   spikes <- which(df[, col] > 1)
#   if (length(spikes) > 0) df <- df[-spikes, ]
# }
# Voltage
for (col in voltageColumns) {
spikes <- which(df[, col] > 1000)
if (length(spikes) > 0) df[spikes, col] <- NA
}
}
df
}
spike_check_nisarkhan <- function(df, type) {
df[, -1] <- lapply(df[, -1], as.numeric)
powerColumns = c("Usage", grep('[kW]', colnames(df), value = T, fixed = T))
voltageColumns = grep('[V]', colnames(df), value = T, fixed = T)
currentColumns = grep('[A]', colnames(df), value = T, fixed = T)
powerfactorColumns = grep('[PF]', colnames(df), value = T, fixed = T)
if (type == "minute") {
# Power
for (col in powerColumns) {
if (col %in% colnames(df)){
spikes <- which(df[, col] > 4)
if (length(spikes) > 0) df[spikes, col] <- NA
}
}
# PowerFactor
# for (col in powerfactorColumns) {
#   spikes <- which(df[, col] > 1)
#   if (length(spikes) > 0) df <- df[-spikes, ]
# }
# Voltage
for (col in voltageColumns) {
spikes <- which(df[, col] > 1000)
if (length(spikes) > 0) df[spikes, col] <- NA
}
} else {
# Power
for (col in powerColumns) {
if (col %in% colnames(df)) {
spikes <- which(df[, col] > 4)
if (length(spikes) > 0) df[spikes, col] <- NA
}
}
# PowerFactor
# for (col in powerfactorColumns) {
#   spikes <- which(df[, col] > 1)
#   if (length(spikes) > 0) df <- df[-spikes, ]
# }
# Voltage
for (col in voltageColumns) {
spikes <- which(df[, col] > 1000)
if (length(spikes) > 0) df[spikes, col] <- NA
}
}
df
}
filter_tree <- function(node) {
# If the node is a list, process each element
if (is.list(node)) {
# Filter node to retain only elements that are lists or have the key 'name'
filtered_node <- node[sapply(names(node), function(k) is.list(node[[k]]) || k == "name")]
# Recursively apply the filtering function to all sub-lists
filtered_node <- lapply(filtered_node, filter_tree)
return(filtered_node)
} else {
# If the node is not a list, return it as is (base case)
return(node)
}
}
correcting_columns = function(Usage_data, Meter_id){
# Meter_id = 49895
## Check if column names file exists
if(file.exists(paste0("../EnergyMonitor2.0/Egauge Column Names/", Meter_id, "_New_column_names.csv"))){
## Read file new column names
New_column_names_df <- read.csv(paste0("../EnergyMonitor2.0/Egauge Column Names/", Meter_id, "_New_column_names.csv"))
## Select columns from API call data present in the file
Usage_data <- Usage_data[,c(1,2,which(colnames(Usage_data) %in% New_column_names_df$Old_name))]
Usage_data[,2:ncol(Usage_data)] = abs(Usage_data[,2:ncol(Usage_data)])
new_indexes <- match(New_column_names_df$Old_name, colnames(Usage_data))
## Change column names of selected columns
colnames(Usage_data)[new_indexes] = New_column_names_df$New_name
## Change column names of the first two columns
colnames(Usage_data)[1:2] = c("DateTime", "Usage")
## Correct date-time data type
Usage_data$DateTime = as.POSIXct(Usage_data$DateTime)
return(Usage_data)
} else {
## Only select date-time and usage column
Usage_data = Usage_data[,c(1,2)]
## Correct column name
colnames(Usage_data)[1:2] = c("DateTime", "Usage")
## Correct date-time data type
Usage_data$DateTime = as.POSIXct(Usage_data$DateTime)
return(Usage_data)
}
}
css <- HTML(".btn-primary {
color: #FFFFFF;
font-weight: bold;
background-color: #58A894;
border-color: #58A894;
}
.panel-primary {
border-color: #000000;
}
")
today_data_hourly = historic_file_load(as.character(date), as.character(date+1), dir_hourwise, meterType, buildingMap)$summaryData %>% spike_check("hour")
RUN_MODE <- 'DEP'
today_data_hourly = historic_file_load(as.character(date), as.character(date+1), dir_hourwise, meterType, buildingMap)$summaryData %>% spike_check("hour")
setwd("/srv/shiny-server/EnvizFleet")
today_data_hourly = historic_file_load(as.character(date), as.character(date+1), dir_hourwise, meterType, buildingMap)$summaryData %>% spike_check("hour")
View(today_data_hourly)
today_data_hourly = historic_file_load(as.character(date), as.character(date+1), dir_hourwise, meterType, buildingMap)$summaryData
View(today_data_hourly)
library(lubridate)
library(plyr)
library(dplyr)
library(DBI)
library(RPostgres)
library(tictoc)
setwd("/srv/shiny-server/Clients Usage Data/Neubolt Meter Data")
clients <- read.csv("../client_profiles.csv", check.names = F)
clients <- clients[!clients$user %in% c('farooq', 'ahmad'), ]
clients <- clients[clients$user == 'alfatah', ]
#   # Set dates in Pakistan timezone
#   pakistan_tz <- "Asia/Karachi"
#   start_date <- as.Date(with_tz(Sys.time(), tzone = pakistan_tz)) - days_past
#   end_date <- as.Date(with_tz(Sys.time(), tzone = pakistan_tz))
file_gen <- function(clients, days_past = 1) {
clients <- clients[clients$Meter_type == "neubolt", ]
# start_date <- Sys.Date()-days_past
# end_date <- Sys.Date()
pakistan_tz <- "Asia/Karachi"
start_date <- as.Date(with_tz(Sys.time(), tzone = pakistan_tz)) - days_past
end_date <- as.Date(with_tz(Sys.time(), tzone = pakistan_tz))
for (client in 1:nrow(clients)) {
current_client <- clients[client, ]
if (current_client$user %in% c("demo", 'demo1', 'demo2', 'demo3')) next
print(paste0("Client: ", current_client$user))
config <- data.frame()
if(file.exists(paste0("Column Correction/", current_client$Meter_id, "_Config.csv")))
config <- read.csv(paste0("Column Correction/", current_client$Meter_id, "_Config.csv"), check.names = F)
else next
if (nrow(config) == 0) next
meters <- unique(config$old_name)
meters_raw_data <- list()
dates_list <- seq.Date(from = start_date, to = end_date, by = 'day')
for (meter in 1:length(meters)) {
current_meter <- meters[meter]
print(current_meter)
slots = as.numeric(substr(current_meter, 3, 3))
if (is.na(slots)) slots <- 1
cat("Fetching Data\n")
res_total <- data.frame()
for (date_idx in 1:length(dates_list)) {
current_date <- dates_list[date_idx]
db_name <- paste0("slot", slots, "_", format(current_date, "%Y-%m-%d"))
res <- data.frame()
while(TRUE) {
tryCatch({
conn <- dbConnect(RPostgres::Postgres(),
dbname = db_name,
host = "localhost",
port = 5432,
user = "postgres",
password = "hakuna_matata8")
if (dbExistsTable(conn, current_meter)) {
query <- paste0("SELECT * FROM \"", current_meter, "\"")
res <- dbGetQuery(conn, query)
}
dbDisconnect(conn)
break
}, error = function(e) {
print(e$message)
if (exists("conn")) dbDisconnect(conn)
})
}
if (nrow(res) > 0) {
if (nrow(res_total) == 0) res_total <- res
else res_total <- rbind.fill(res_total, res)
}
}
if (nrow(res_total) < 1) next
res <- res_total
res <- res[, 3:ncol(res)]
# res[[1]] <- as.POSIXct(res[[1]])
res[[1]] <- as.POSIXct(res[[1]], tz = "Asia/Karachi")
res[, 2:ncol(res)] <- as.data.frame(lapply(res[, 2:ncol(res)], as.numeric))
res[, 2:ncol(res)] <- as.data.frame(lapply(res[, 2:ncol(res)], function(x) suppressWarnings(as.numeric(as.character(x)))))
res <- res[!duplicated(res[[1]]), ]
# res[[1]] <- floor_date(res[[1]], unit="minutes")
res[[1]] <- floor_date(res[[1]], unit = "minutes")
attr(res[[1]], "tzone") <- "Asia/Karachi"
res <- res %>%
group_by(TimeStamp) %>%
dplyr::summarise(across(where(is.numeric), mean))
colnames(res)[1] <- "Date & Time"
meters_raw_data[[current_meter]] <- res
}
## Final data to be converted to csv
saveData <- data.frame('Date & Time' = seq.POSIXt(from = as.POSIXct(start_date),
to = as.POSIXct(end_date+1), by = "min", tz = "Asia/Karachi"), check.names = F)
saveData <- saveData[-nrow(saveData), ] %>% as.data.frame()
colnames(saveData) <- "Date & Time"
appliances <- config$new_name
for (app in 1:length(appliances)) {
current_appliance <- appliances[app]
current_meter <- config$old_name[app]
meterData <- meters_raw_data[[current_meter]]
if (is.null(meterData)) {
saveData[[paste0(current_appliance, '_[V]')]] <- NA
saveData[[paste0(current_appliance, '_[A]')]] <- NA
saveData[[paste0(current_appliance, '_[kW]')]] <- NA
saveData[[paste0(current_appliance, '_[PF]')]] <- NA
saveData[[paste0(current_appliance, '_[F]')]] <- NA
next
}
tz(meterData[[1]]) <- "UTC"
## Voltage
meterData <- meterData %>%
mutate(temp = eval(parse(text = config$Voltage[app])))
number_of_slots <- length(strsplit(config$Voltage[app], "\\+") %>% unlist())
meterData$temp <- meterData$temp / number_of_slots
if (current_client$user == 'prime') meterData$temp <- meterData$temp * sqrt(3)
else if (number_of_slots > 2) meterData$temp <- meterData$temp * sqrt(3)
saveData <- merge(saveData, meterData[, c(1, ncol(meterData))], by = "Date & Time", all.x = T)
colnames(saveData)[colnames(saveData) == "temp"] <- paste0(current_appliance, '_[V]')
## Current
meterData <- meterData %>%
mutate(temp = eval(parse(text = config$Current[app])))
meterData$temp <- meterData$temp / number_of_slots
saveData <- merge(saveData, meterData[, c(1, ncol(meterData))], by = "Date & Time", all.x = T)
colnames(saveData)[colnames(saveData) == "temp"] <- paste0(current_appliance, '_[A]')
## Power
meterData <- meterData %>% mutate(temp = eval(parse(text = config$Power[app])))
saveData <- merge(saveData, meterData[, c(1, ncol(meterData))], by = "Date & Time", all.x = T)
colnames(saveData)[colnames(saveData) == "temp"] <- paste0(current_appliance, '_[kW]')
## PowerFactor
meterData <- meterData %>%
mutate(temp = eval(parse(text = config$PowerFactor[app])))
meterData$temp <- meterData$temp / number_of_slots
saveData <- merge(saveData, meterData[, c(1, ncol(meterData))], by = "Date & Time", all.x = T)
colnames(saveData)[colnames(saveData) == "temp"] <- paste0(current_appliance, '_[PF]')
## Frequency
meterData <- meterData %>%
mutate(temp = eval(parse(text = config$Frequency[app])))
meterData$temp <- meterData$temp / number_of_slots
saveData <- merge(saveData, meterData[, c(1, ncol(meterData))], by = "Date & Time", all.x = T)
colnames(saveData)[colnames(saveData) == "temp"] <- paste0(current_appliance, '_[F]')
}
saveData <- saveData[rowSums(is.na(saveData[, -1])) < ncol(saveData) - 1, ]
for (coln in 1:length(colnames(saveData))) {
colname <- colnames(saveData)[coln]
if (substr(colname, nchar(colname)-1, nchar(colname)) == ".1") colname <- substr(colname, 1, nchar(colname)-2)
colnames(saveData)[coln] <- colname
}
## Duplicate column removal (for multi-meters on same appliance)
same_name_columns <- unique(names(saveData[duplicated(names(saveData))]))
for (col_name in same_name_columns) {
if (substr(col_name, nchar(col_name)-3, nchar(col_name)) == "[kW]")
saveData[[paste0(".", col_name)]] <- rowSums(saveData[, startsWith(names(saveData), col_name)], na.rm = TRUE)
else
saveData[[paste0(".", col_name)]] <- rowMeans(saveData[, startsWith(names(saveData), col_name)], na.rm = TRUE)
saveData <- saveData[, !startsWith(names(saveData), col_name), drop = FALSE]
column_index <- which(colnames(saveData) == paste0(".", col_name))
colnames(saveData)[column_index] <- gsub('\\.', '', colnames(saveData)[column_index])
}
# if (clients$user[client] == "kruncheese") {
#   saveData$`Main_[kW]` <- saveData$`Main_[kW]`*5
#   saveData$`Generator_[kW]` <- saveData$`Generator_[kW]`*5
#   saveData$`Main Phase 1_[kW]` <- saveData$`Main Phase 1_[kW]`*5
#   saveData$`Main Phase 2_[kW]` <- saveData$`Main Phase 2_[kW]`*5
#   saveData$`Main Phase 3_[kW]` <- saveData$`Main Phase 3_[kW]`*5
#
#   saveData$`Main_[A]` <- saveData$`Main_[A]`*5
#   saveData$`Generator_[A]` <- saveData$`Generator_[A]`*5
#   saveData$`Main Phase 1_[A]` <- saveData$`Main Phase 1_[A]`*5
#   saveData$`Main Phase 2_[A]` <- saveData$`Main Phase 2_[A]`*5
#   saveData$`Main Phase 3_[A]` <- saveData$`Main Phase 3_[A]`*5
# }
if (clients$user[client] == 'dunya') {
if ("Studio 5.6 (Light)_[kW]" %in% colnames(saveData)) {
saveData$`Studio 5.6 (Light)_[kW]` <- saveData$`Studio 5.6 (Light)_[kW]`*5
saveData$`Studio 5.6 (Light)_[A]` <- saveData$`Studio 5.6 (Light)_[A]`*5
}
} else if (clients$user[client] == 'progressive') {
saveData$`Low Pressure Compressor 1_[kW]` <- saveData$`Low Pressure Compressor 1_[kW]` * 5
saveData$`Low Pressure Compressor 1_[A]` <- saveData$`Low Pressure Compressor 1_[A]` * 5
saveData$`Low Pressure Compressor 2_[kW]` <- saveData$`Low Pressure Compressor 2_[kW]` * 5
saveData$`Low Pressure Compressor 2_[A]` <- saveData$`Low Pressure Compressor 2_[A]` * 5
} else if (clients$user[client] == 'razakhantb1') {
saveData$`Solar_[V]` <- (saveData$`Main_[V]` + saveData$`Motor_[V]`) / 2
saveData$`Solar_[A]`[saveData$`Solar_[A]` < 0] <- 0
saveData$`Solar_[kW]`[saveData$`Solar_[kW]` < 0] <- 0
saveData$`Main_[PF]` <- (saveData$`Main_[PF]` + saveData$`Motor_[PF]`) / 2
} else if (clients$user[client] == 'cobija') {
saveData <- saveData %>%
mutate(`Textile Building_[kW]` = rowSums(cbind(`Textile Building_[kW]`, -1 * `Ceiling Hall + Compressor Room_[kW]`), na.rm = TRUE))
saveData <- saveData %>%
mutate(`Textile Building_[A]` = rowSums(cbind(`Textile Building_[A]`, -1 * `Ceiling Hall + Compressor Room_[A]`), na.rm = TRUE))
saveData <- saveData %>%
mutate(`IT Hall + Stitching Area_[kW]` = rowSums(cbind(`IT Hall + Stitching Area_[kW]`, -1 * `Offices Area_[kW]`), na.rm = TRUE))
saveData <- saveData %>%
mutate(`IT Hall + Stitching Area_[A]` = rowSums(cbind(`IT Hall + Stitching Area_[A]`, -1 * `Offices Area_[A]`), na.rm = TRUE))
} else if (clients$user[client] == 'nixor') {
saveData <- saveData %>%
mutate(`Building 2_[V]` = rowMeans(cbind(`Main_[V]`, `Generator_[V]`, `Solar Consumption_[V]`, `Building 1_[V]`), na.rm = TRUE))
saveData <- saveData %>%
mutate(`Building 2_[A]` = rowSums(cbind(`Main_[A]`, `Generator_[A]`, `Solar Consumption_[A]`, -1 * `Building 1_[A]`), na.rm = TRUE))
saveData <- saveData %>%
mutate(`Building 2_[kW]` = rowSums(cbind(`Main_[kW]`, `Generator_[kW]`, `Solar Consumption_[kW]`, -1 * `Building 1_[kW]`), na.rm = TRUE))
saveData <- saveData %>%
mutate(`Building 2_[PF]` = rowMeans(cbind(`Main_[PF]`, `Generator_[PF]`, `Solar Consumption_[PF]`, `Building 1_[PF]`), na.rm = TRUE))
saveData <- saveData %>%
mutate(`Building 2 phase 1_[V]` = rowMeans(cbind(`Main phase 1_[V]`, `Generator phase 1_[V]`, `Solar Consumption phase 1_[V]`, `Building 1 phase 1_[V]`), na.rm = TRUE))
saveData <- saveData %>%
mutate(`Building 2 phase 1_[A]` = rowSums(cbind(`Main phase 1_[A]`, `Generator phase 1_[A]`, `Solar Consumption phase 1_[A]`, -1 * `Building 1 phase 1_[A]`), na.rm = TRUE))
saveData <- saveData %>%
mutate(`Building 2 phase 1_[kW]` = rowSums(cbind(`Main phase 1_[kW]`, `Generator phase 1_[kW]`, `Solar Consumption phase 1_[kW]`, -1 * `Building 1 phase 1_[kW]`), na.rm = TRUE))
saveData <- saveData %>%
mutate(`Building 2 phase 1_[PF]` = rowMeans(cbind(`Main phase 1_[PF]`, `Generator phase 1_[PF]`, `Solar Consumption phase 1_[PF]`, `Building 1 phase 1_[PF]`), na.rm = TRUE))
saveData <- saveData %>%
mutate(`Building 2 phase 2_[V]` = rowMeans(cbind(`Main phase 2_[V]`, `Generator phase 2_[V]`, `Solar Consumption phase 2_[V]`, `Building 1 phase 2_[V]`), na.rm = TRUE))
saveData <- saveData %>%
mutate(`Building 2 phase 2_[A]` = rowSums(cbind(`Main phase 2_[A]`, `Generator phase 2_[A]`, `Solar Consumption phase 2_[A]`, -1 * `Building 1 phase 2_[A]`), na.rm = TRUE))
saveData <- saveData %>%
mutate(`Building 2 phase 2_[kW]` = rowSums(cbind(`Main phase 2_[kW]`, `Generator phase 2_[kW]`, `Solar Consumption phase 2_[kW]`, -1 * `Building 1 phase 2_[kW]`), na.rm = TRUE))
saveData <- saveData %>%
mutate(`Building 2 phase 2_[PF]` = rowMeans(cbind(`Main phase 2_[PF]`, `Generator phase 2_[PF]`, `Solar Consumption phase 2_[PF]`, `Building 1 phase 2_[PF]`), na.rm = TRUE))
saveData <- saveData %>%
mutate(`Building 2 phase 3_[V]` = rowMeans(cbind(`Main phase 3_[V]`, `Generator phase 3_[V]`, `Solar Consumption phase 3_[V]`, `Building 1 phase 3_[V]`), na.rm = TRUE))
saveData <- saveData %>%
mutate(`Building 2 phase 3_[A]` = rowSums(cbind(`Main phase 3_[A]`, `Generator phase 3_[A]`, `Solar Consumption phase 3_[A]`, -1 * `Building 1 phase 3_[A]`), na.rm = TRUE))
saveData <- saveData %>%
mutate(`Building 2 phase 3_[kW]` = rowSums(cbind(`Main phase 3_[kW]`, `Generator phase 3_[kW]`, `Solar Consumption phase 3_[kW]`, -1 * `Building 1 phase 3_[kW]`), na.rm = TRUE))
saveData <- saveData %>%
mutate(`Building 2 phase 3_[PF]` = rowMeans(cbind(`Main phase 3_[PF]`, `Generator phase 3_[PF]`, `Solar Consumption phase 3_[PF]`, `Building 1 phase 3_[PF]`), na.rm = TRUE))
}
## File Generation
dates <- seq.Date(from = start_date, to = end_date, by = "day")
## Dir check
if (!dir.exists("data")) dir.create("data")
if (!dir.exists("data/minute-wise Data")) dir.create("data/minute-wise Data")
if (!dir.exists("data/hour-wise Data")) dir.create("data/hour-wise Data")
if (!dir.exists(paste0("data/minute-wise Data/", current_client$user)))
dir.create(paste0("data/minute-wise Data/", current_client$user))
if (!dir.exists(paste0("data/hour-wise Data/", current_client$user)))
dir.create(paste0("data/hour-wise Data/", current_client$user))
for (day in 1:length(dates)) {
print(paste0("Date: ", as.POSIXct(dates[day]), " -------------"))
todayData <- saveData[as.Date(saveData$`Date & Time`) == dates[day], ]
today_hour <- todayData
if (nrow(todayData) == 0) next
# Minute wise
todayData$`Date & Time` <- todayData$`Date & Time` %>% as.character()
if (nchar(todayData$`Date & Time`[1]) == 10)
todayData$`Date & Time`[1] <- paste0(todayData$`Date & Time`[1], " 00:00:00")
file_minutewise <- paste0("data/minute-wise Data/", current_client$user, "/", current_client$Meter_id, "_", dates[day], "_minute-wise.csv")
# if (file.exists(file_minutewise)) {
#   original_file <- read.csv(file_minutewise, check.names = F)
#   todayData <- merge(original_file, todayData, all = T)
#   todayData <- todayData %>%
#     group_by(`Date & Time`) %>%
#     dplyr::summarise(across(where(is.numeric), ~ mean(.x, na.rm = T)))
# }
# if (file.exists(file_minutewise)) {
#   original_file <- read.csv(file_minutewise, check.names = F)
#   todayData <- merge(original_file, todayData, all.y = T, by = "Date & Time")
#   todayData <- todayData %>%
#     group_by(`Date & Time`) %>%
#     dplyr::summarise(across(where(is.numeric), ~ mean(.x, na.rm = T)))
# }
if (file.exists(file_minutewise)) {
original_file <- read.csv(file_minutewise, check.names = F)
todayData <- bind_rows(todayData,original_file) %>%
group_by(`Date & Time`) %>%
dplyr::summarise(across(where(is.numeric), ~ mean(.x, na.rm = T)))
}
write.csv(todayData, file_minutewise, row.names = F, na = "")
# Hour wise
today_hour[[1]] <- floor_date(today_hour[[1]], "hour")
today_hour <- today_hour %>%
group_by(`Date & Time`) %>%
dplyr::summarise(across(where(is.numeric), ~ sum(.x, na.rm = T) / 60))
today_hour$`Date & Time` <- today_hour$`Date & Time` %>% as.character()
if (nchar(today_hour$`Date & Time`[1]) == 10)
today_hour$`Date & Time`[1] <- paste0(today_hour$`Date & Time`[1], " 00:00:00")
file_hourwise <- paste0("data/hour-wise Data/", current_client$user, "/", current_client$Meter_id, "_", dates[day], "_hour-wise.csv")
# if (file.exists(file_hourwise)) {
#   original_file <- read.csv(file_hourwise, check.names = F)
#   today_hour <- merge(original_file, today_hour, all = T)
#   today_hour <- today_hour %>%
#     group_by(`Date & Time`) %>%
#     dplyr::summarise(across(where(is.numeric), ~ mean(.x, na.rm = T)))
# }
# if (file.exists(file_hourwise)) {
#   original_file <- read.csv(file_hourwise, check.names = F)
#   today_hour <- merge(original_file, today_hour, all.y = T, by = "Date & Time")
#   today_hour <- today_hour %>%
#     group_by(`Date & Time`) %>%
#     dplyr::summarise(across(where(is.numeric), ~ mean(.x, na.rm = T)))
# }
if (file.exists(file_hourwise)) {
original_file <- read.csv(file_hourwise, check.names = F)
today_hour <- bind_rows(today_hour,original_file) %>%
group_by(`Date & Time`) %>%
dplyr::summarise(across(where(is.numeric), ~ mean(.x, na.rm = T)))
}
write.csv(today_hour, file_hourwise, row.names = F, na = "")
}
}
}
file_gen(clients)
username = 'tariqglass'
password = 'tariqglass123'
setwd("/srv/shiny-server/EnvizAPI")
is.null(username) || is.null(password
is.null(username) || is.null(password)
is.null(username) || is.null(password)
clients <- read.csv("../Clients Usage Data/client_profiles.csv")
client_settings <- read.csv("../Clients Usage Data/client_settings.csv")
clients <- merge(clients, client_settings)
# client_settings <- client_settings[client_settings$user == username & client_settings$password == password, ]
# if (nrow(client_settings) == 0) return(list(error = "Invalid Credentials"))
client <- clients[clients$user == username & clients$password == password, ]
clients <- read.csv("../Clients Usage Data/client_profiles.csv")
client_settings <- read.csv("../Clients Usage Data/client_settings.csv")
clients <- merge(clients, client_settings)
clients <- read.csv("../Clients Usage Data/client_profiles.csv")
client_settings <- read.csv("../Clients Usage Data/client_settings.csv")
clients <- merge(clients, client_settings, by = 'user')
# client_settings <- client_settings[client_settings$user == username & client_settings$password == password, ]
# if (nrow(client_settings) == 0) return(list(error = "Invalid Credentials"))
client <- clients[clients$user == username & clients$password == password, ]
`50153_buildingMap` <- readRDS("/srv/shiny-server/EnergyMonitor2.0/50153_buildingMap.rds")
View(`50153_buildingMap`)
runApp('/srv/shiny-server/EnvizFleet/app (3rd copy).R')
runApp('/srv/shiny-server/EnvizFleet/app (3rd copy).R')
runApp('/srv/shiny-server/EnvizFleet/app (3rd copy).R')
plumber::plumb(file='plumber.R')$run()
plumb(file='plumber.R')$run()
runApp('/srv/shiny-server/EnvizFleet/app (3rd copy).R')
runApp('/srv/shiny-server/EnvizFleet/app (3rd copy).R')
runApp('/srv/shiny-server/EnvizFleet/app (3rd copy).R')
runApp('/srv/shiny-server/EnvizFleet/app (3rd copy).R')
runApp('/srv/shiny-server/Smart Switch2')
runApp('/srv/shiny-server/Smart Switch2')
runApp('/srv/shiny-server/Smart Switch2')
runApp('/srv/shiny-server/Smart Switch2')
runApp('/srv/shiny-server/SmartSwitch')
runApp('/srv/shiny-server/SmartSwitch')
runApp('/srv/shiny-server/Smart Switch2 (copy)')
runApp('/srv/shiny-server/Smart Switch2 (copy)')
runApp('/srv/shiny-server/Smart Switch2 (copy)')
runApp('/srv/shiny-server/Smart Switch2 (copy)')
runApp('/srv/shiny-server/EnvizFleetPayment/app (copy).R')
runApp('/srv/shiny-server/EnvizFleetPayment/app (another copy).R')
runApp('/srv/shiny-server/EnvizFleetPayment/app (another copy).R')
runApp('/srv/shiny-server/EnvizFleet1')
runApp('/srv/shiny-server/EnvizFleetPayment/app (another copy).R')
runApp('/srv/shiny-server/EnvizFleet/app (API).R')
runApp('/srv/shiny-server/EnvizShifting/passapp (another copy).R')
runApp('/srv/shiny-server/EnvizShifting/passapp (copy).R')
runApp('/srv/shiny-server/EnvizShifting/passapp (another copy).R')
